<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>SetUp </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="SetUp ">
      
      <link rel="icon" href="../favicon.ico">
      <link rel="stylesheet" href="../public/docfx.min.css">
      <link rel="stylesheet" href="../public/main.css">
      <meta name="docfx:navrel" content="../toc.json">
      <meta name="docfx:tocrel" content="toc.json">
      
      
      
      
      <meta name="docfx:docurl" content="https://github.com/AutomotiveAIChallenge/aichallenge2023-racing/blob/main/documentation/docfx_project/setup/index.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">
  </head>

  <script type="module" src="./../public/docfx.min.js"></script>

  <script>
    const theme = localStorage.getItem('theme') || 'auto'
    document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
  </script>


  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../index.html">
            <img id="logo" class="svg" src="../logo.svg" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" style="margin-top: -.65em; margin-left: -.8em" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="setup">SetUp</h1>

<!--br>

> [!REGISTER]
> こちらから参加登録!
> [https://www.jsae.or.jp/jaaic/en/index.php](https://www.jsae.or.jp/jaaic/en/index.php)

<br> -->
<h2 id="minimum-hardware-requirements">Minimum Hardware Requirements</h2>
<p>本大会で使用していただくPCの動作環境として以下を推奨しております。</p>
<ul>
<li>OS: Ubuntu 22.04</li>
<li>CPU: Intel Corei7 (8 cores) or higher</li>
<li>GPU: NVIDIA Geforce RTX 1060 or higher</li>
<li>Memory: 32 GB or more</li>
<li>Storage: SSD 30 GB or higher</li>
</ul>
<p>上記のスペックを満たすPCをご用意できない方は、下記の「PC2台で参加する方向け」のスペックをご参照ください。</p>
<h3 id="2台のpcを使用する方向け">2台のPCを使用する方向け</h3>
<h4 id="autoware-pc">Autoware PC</h4>
<ul>
<li>OS: Ubuntu 22.04</li>
<li>CPU: Intel Corei7 (4 cores) or higher</li>
<li>GPU: NVIDIA Geforce GTX 1060 or higher</li>
<li>Memory: 16 GB or higher</li>
<li>Storage: SSD 10 GB or higher</li>
<li>詳細は<a href="https://autowarefoundation.github.io/autoware-documentation/main/installation/">こちら</a></li>
</ul>
<h4 id="awsim-pc">AWSIM PC</h4>
<ul>
<li>OS: Ubuntu 22.04</li>
<li>CPU: Intel Corei7 (4 cores and 8 threads) or higher</li>
<li>GPU: NVIDIA Geforce RTX 1060 or higher</li>
</ul>
<p>※Autoware動作PCとAWSIM動作PCは、同じネットワーク内に配置してください。
配置できていれば、基本的には追加設定をすることなく、PC間のトピック通信は可能です。万が一、トピック通信ができなかった場合はファイアーウォールの解除、もしくはルールの見直しをお願いします。</p>
<h3 id="cpu-only-のnotepcを使用される方向け">CPU only のNotePCを使用される方向け</h3>
<h4 id="minimum-hardware-requirements-for-headless-mode">Minimum Hardware Requirements for Headless mode</h4>
<p>本大会で使用していただくPCの動作環境としてサポートを十分に提供できない可能性がありますが、
今後より多くの方にコンテストに参加し、活発なディスカッションを行っていただくために、
試験的に以下のCPUのみの構成のPCのみでも参加可能になるようにしました。</p>
<ul>
<li>OS: Ubuntu 22.04</li>
<li>CPU: Intel Core i7-8650U (4 cores) with Intel HD Graphics (no NVIDIA GPUs)</li>
<li>Memory: 16 GB or more</li>
<li>Storage: SSD 16 GB or higher</li>
</ul>
<ul>
<li>other CPU only cases</li>
</ul>
<ul>
<li><p>CPU : AMD Ryzen 5 5600G with Radeon Graphics</p>
</li>
<li><p>Memory : 32GB</p>
</li>
<li><p>CPU AMD® Ryzen 7 pro 4750u with radeon graphics × 16</p>
</li>
<li><p>Memory 32.0 GiB</p>
</li>
<li><p>DELL XPS 13 9300</p>
</li>
<li><p>CPU: Intel(R) Core(TM) i7-1065G7</p>
</li>
<li><p>Memory: 16GB</p>
</li>
</ul>
<h2 id="environment-setup">Environment Setup</h2>
<h3 id="awsimubuntu">AWSIM(Ubuntu)</h3>
<h4 id="事前準備">事前準備</h4>
<ul>
<li><p>(CPU onlyの方またはすでにNVIDIA Driverがはいっている方はskip) Nvidiaドライバのインストール</p>
<ol>
<li>リポジトリの追加、update、install</li>
</ol>
<pre><code class="lang-sh">sudo add-apt-repository ppa:graphics-drivers/ppa
sudo apt update
sudo ubuntu-drivers autoinstall
</code></pre>
<ol start="2">
<li>再起動の後、下記コマンドを実行し、インストールできていることを確認</li>
</ol>
<pre><code>nvidia-smi
</code></pre>
<p><img src="../images/setup/nvidia-smi.png" alt="nvidia-smi"></p>
</li>
<li><p>Vulkunのインストール</p>
<ol>
<li>パッケージリストの更新</li>
</ol>
<pre><code class="lang-sh">sudo apt update
sudo apt install libvulkan1
</code></pre>
</li>
<li><p>コースの準備</p>
<ol>
<li><a href="https://drive.google.com/drive/folders/1EjgBxB_x0_xRla7_FdPaeEkiOU3vxW7e">GoogleDrive</a>から最新の<code>AWSIM.zip</code>をダウンロードし、<code>aichallenge2023-racing/docker/aichallenge</code>内に大会用AWSIM実行ファイルを展開</li>
<li>パーミッションを図のように変更<br>
<img src="../images/setup/permmision.png" alt="パーミッション変更の様子"></li>
<li>ファイルをダブルクリックで起動</li>
<li>GPU版のAWSIMは下記のような画面が表示されることを確認
(CPU版のAWSIMは画面の描画なし)
<img src="../images/setup/awsim.png" alt="awsim"></li>
</ol>
</li>
</ul>
<h3 id="dockerの事前準備">Dockerの事前準備</h3>
<p>下記のインストールをお願いします。</p>
<ul>
<li><a href="https://docs.docker.com/engine/install/ubuntu/">docker</a></li>
<li><a href="https://github.com/osrf/rocker">rocker</a>
<ul>
<li>Dockerコンテナ内のRviz、rqtなどのGUIを使用するために用います。</li>
</ul>
</li>
<li><a href="https://packagecloud.io/github/git-lfs/install">git lfs</a></li>
</ul>
<p>以下のコマンドでdocker rocker gitlfsがinstallされます</p>
<pre><code class="lang-sh"># docker インストールの下準備
sudo apt-get update
sudo apt-get install ca-certificates curl gnupg
sudo install -m 0755 -d /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
sudo chmod a+r /etc/apt/keyrings/docker.gpg
echo \
  &quot;deb [arch=&quot;$(dpkg --print-architecture)&quot; signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
  &quot;$(. /etc/os-release &amp;&amp; echo &quot;$VERSION_CODENAME&quot;)&quot; stable&quot; | \
  sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null
# 最新のDockerをインストール
sudo apt-get update
sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
# インストールできているかをテスト
sudo docker run hello-world

# rocker install
sudo apt-get install python3-rocker

# gitlfs install
curl -s https://packagecloud.io/install/repositories/github/git-lfs/script.deb.sh | sudo bash
sudo apt-get install git-lfs
git lfs install
</code></pre>
<ul>
<li>(CPU onlyの方はskip)<a href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/install-guide.html">Nvidia Container Toolkit</a>
下記でinstallお願いします。</li>
</ul>
<pre><code class="lang-sh"># インストールの下準備
distribution=$(. /etc/os-release;echo $ID$VERSION_ID) \
      &amp;&amp; curl -fsSL https://nvidia.github.io/libnvidia-container/gpgkey | sudo gpg --dearmor -o /usr/share/keyrings/nvidia-container-toolkit-keyring.gpg \
      &amp;&amp; curl -s -L https://nvidia.github.io/libnvidia-container/$distribution/libnvidia-container.list | \
            sed 's#deb https://#deb [signed-by=/usr/share/keyrings/nvidia-container-toolkit-keyring.gpg] https://#g' | \
            sudo tee /etc/apt/sources.list.d/nvidia-container-toolkit.list

# インストール
sudo apt-get update
sudo apt-get install -y nvidia-container-toolkit
sudo nvidia-ctk runtime configure --runtime=docker
sudo systemctl restart docker

#インストールできているかをテスト
sudo docker run --rm --runtime=nvidia --gpus all nvidia/cuda:11.6.2-base-ubuntu20.04 nvidia-smi

#最後のコマンドで以下のような出力が出れば成功です。
#（下記はNVIDIAウェブサイトからのコピペです）


# +-----------------------------------------------------------------------------+
# | NVIDIA-SMI 450.51.06    Driver Version: 450.51.06    CUDA Version: 11.0     |
# |-------------------------------+----------------------+----------------------+
# | GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |
# | Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |
# |                               |                      |               MIG M. |
# |===============================+======================+======================|
# |   0  Tesla T4            On   | 00000000:00:1E.0 Off |                    0 |
# | N/A   34C    P8     9W /  70W |      0MiB / 15109MiB |      0%      Default |
# |                               |                      |                  N/A |
# +-------------------------------+----------------------+----------------------+
# +-----------------------------------------------------------------------------+
# | Processes:                                                                  |
# |  GPU   GI   CI        PID   Type   Process name                  GPU Memory |
# |        ID   ID                                                   Usage      |
# |=============================================================================|
# |  No running processes found                                                 |
# +-----------------------------------------------------------------------------+

</code></pre>
<ul>
<li><p>Dockerイメージの準備・起動 〜 Autowareの準備</p>
<ol>
<li>Dockerイメージを入手</li>
</ol>
<pre><code>docker pull ghcr.io/automotiveaichallenge/aichallenge2023-racing/autoware-universe-no-cuda
</code></pre>
<p>user groupに自分のアカウントを追加</p>
<pre><code>sudo usermod -aG docker $USER
</code></pre>
<p>以下のコマンドでgroupsにdockerが追加されていることを確認</p>
<pre><code>groups $USER
# $ USERNAME : USERNAME adm cdrom sudo ... docker
</code></pre>
<p>ここまで確認できたら再度loginし直す</p>
<p>docker imagesで以下のような表示が見えていることを確認</p>
<pre><code>REPOSITORY                                                                       TAG                                 IMAGE ID       CREATED          SIZE
ghcr.io/automotiveaichallenge/aichallenge2023-racing/autoware-universe-no-cuda   latest                              9601fc85f1bd   3 weeks ago      7.31GB    
</code></pre>
<ol start="2">
<li>大会用データのダウンロード</li>
</ol>
<pre><code>sudo apt install -y git-lfs
git lfs clone https://github.com/AutomotiveAIChallenge/aichallenge2023-racing
</code></pre>
<ol start="3">
<li>大会用dockerイメージのビルド</li>
</ol>
<pre><code>cd aichallenge2023-racing/docker/train
bash build_docker.sh
</code></pre>
<ol start="4">
<li>大会用dockerコンテナの起動</li>
</ol>
<p>GPU環境の方は以下</p>
<pre><code>bash run_container.sh
</code></pre>
<p>CPUのみの環境の方は以下</p>
<pre><code>bash run_container_cpu.sh
</code></pre>
</li>
</ul>
<h4 id="dockerコンテナ内でのawsim起動">Dockerコンテナ内でのAWSIM起動</h4>
<p>DockerコンテナからAWSIMを起動したい場合は、Dockerイメージの準備手順(前述)に従ってDockerイメージを導入した後、以下の手順で行ってください。</p>
<ol>
<li><code>aichallenge2023-racing/docker/aichallenge</code>内に大会用AWSIM実行ファイルを展開(以下、<code>aichallenge2023-racing/docker/aichallenge/AWSIM/AWSIM.x86_64</code>に配置されているものとします。)</li>
<li>rockerを起動
新たにterminalを開いて<code>docker image ls</code>で以下のようなimageが存在していることを確認してください。</li>
</ol>
<pre><code>REPOSITORY                                                                      TAG                                 IMAGE ID       CREATED          SIZE
aichallenge-train                                                               latest                              67a4d45d119d   16 minutes ago   7.37GB
</code></pre>
<p>確認ができたら以下のコマンドでrockerを起動してください。</p>
<p>GPU環境の方は以下</p>
<pre><code> cd ./aichallenge2023-racing/docker/train
 bash run_container.sh
</code></pre>
<p>CPUのみの環境の方は以下</p>
<pre><code> cd ./aichallenge2023-racing/docker/train
 bash run_container_cpu.sh
</code></pre>
<p>新たに開いたterminalで<code>docker images</code> で以下のようにdocker が存在していることを確認してください。</p>
<pre><code>REPOSITORY                                                                      TAG                                 IMAGE ID       CREATED          SIZE
aichallenge-train                                                               latest                              67a4d45d119d   16 minutes ago   7.37GB   
</code></pre>
<ol>
<li>コンテナ内で以下を実行</li>
</ol>
<pre><code> cd /aichallenge
 bash run_awsim.sh 
</code></pre>
<div class="NOTE">
<h5>Note</h5>
<p>AWSIMからpublish・subscribeされているトピックのメッセージは，一部<code>/aichallenge/aichallenge_ws/src/sim-msgs</code>で定義されています．これらのメッセージを扱うには，以下のコマンドを実行してください．</p>
<pre><code>cd /aichallenge
bash build_autoware.sh
source /aichallenge/aichallenge_ws/install/setup.bash 
</code></pre>
</div>
<h3 id="地図データosmの配置-wip">地図データosmの配置 WIP</h3>
<p>本大会ではlanelet2_mapファイルの改変を可としました。
<code>/aichallenge2023-racing/docker/aichallenge/aichallenge_ws/src/aichallenge_submit/aichallenge_submit_launch/map/*</code>に配置して、ファイル構成が以下になるように配置してください。</p>
<pre><code>aichallenge2023-racing
└ docker
 └ aichallenge
  └ AWSIM
  └ aichallenge_ws/src/aichallenge_submit/aichallenge_submit_launch
     └map
      └lanelet2_map.osm
</code></pre>
<p>※ 経路計画を行う際にlanelet2_map参照して行わないといけないなどの制約もございません。（csvファイルを参照し経路を生成することも可とします。）
※ PCDファイルは入れていますが、今回提出していただく必要はございません。Mapの編集に必要な場合のみご使用ください。</p>
<h3 id="autoware">Autoware</h3>
<ul>
<li>Autowareの動作確認<br>
AWSIMを用いて、Autowareの動作確認を行う方法を記します。
<ol>
<li>AWSIMを起動</li>
<li>Autowareを起動</li>
</ol>
<pre><code># Rockerコンテナ内で
cd /aichallenge
bash build_autoware.sh
bash run_autoware.sh
</code></pre>
<ol start="3">
<li><p>下記のような画面(Rviz2)が表示されることを確認<br>
<img src="../images/setup/autoware1.png" alt="autoware1"></p>
</li>
<li><p>タブにある2D Goal Poseを選択し、ゴールポジションをドラッグで指定。画像のように、ルートが表示されている かつ <code>Routing</code>が<code>UNSET</code>から<code>SET</code>に変わっていることを確認（指定してから少し時間がかかります）<br>
<img src="../images/setup/autoware3.png" alt="autoware3"></p>
</li>
</ol>
</li>
</ul>
<h3 id="2回目以降の起動">2回目以降の起動</h3>
<ol>
<li>AWSIMの起動
<ol>
<li>コンテナの起動</li>
</ol>
<pre><code> cd ./aichallenge2023-racing/docker/train
 bash run_container.sh または bash run_container_cpu.sh
</code></pre>
<ol start="2">
<li>コンテナ内部でAWSIMの起動</li>
</ol>
<pre><code> cd /aichallenge
 bash run_awsim.sh 
</code></pre>
</li>
<li>Autowareの起動
<ol>
<li>コンテナの起動</li>
</ol>
<pre><code> cd ./aichallenge2023-racing/docker/train
 bash run_container.sh または bash run_container_cpu.sh
</code></pre>
<ol start="2">
<li>必要に応じてコンテナ内部でAutowareのbuild</li>
</ol>
<pre><code> cd /aichallenge
 bash build_autoware.sh 
</code></pre>
<ol start="3">
<li>コンテナ内部でAutowareの起動</li>
</ol>
<pre><code> cd /aichallenge
 bash run_autoware.sh
</code></pre>
</li>
</ol>
<h3 id="画面録画の方法">画面録画の方法</h3>
<p>デフォルトのrockerではディスプレイドライバを自分のPCに設定できていないため以下のオプションを追加する必要があります。</p>
<pre><code>#!/bin/bash
rocker --device /dev/dri --x11 --user ... # CPU版
rocker --device /dev/dri --nvidia --x11 --user ... # GPU版
</code></pre>
<h3 id="変更点の取り込み">変更点の取り込み</h3>
<h4 id="dockerのupdate">dockerのupdate</h4>
<pre><code class="lang-sh">docker pull ghcr.io/automotiveaichallenge/aichallenge2023-racing/autoware-universe-no-cuda
</code></pre>
<h4 id="repositoryのupdate">repositoryのupdate</h4>
<pre><code class="lang-sh">cd aichallenge2023-racing # path to aichallenge2023-racing
git pull origin/main
</code></pre>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/AutomotiveAIChallenge/aichallenge2023-racing/blob/main/documentation/docfx_project/setup/index.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>


    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>
