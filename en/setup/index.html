<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>SetUp </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="SetUp ">
      
      <link rel="icon" href="../favicon.ico">
      <link rel="stylesheet" href="../public/docfx.min.css">
      <link rel="stylesheet" href="../public/main.css">
      <meta name="docfx:navrel" content="../toc.html">
      <meta name="docfx:tocrel" content="toc.html">
      
      
      
      
      <meta name="docfx:docurl" content="https://github.com/AutomotiveAIChallenge/aichallenge2023-racing/blob/main/documentation/docfx_project_en/setup/index.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">
  </head>

  <script type="module" src="./../public/docfx.min.js"></script>

  <script>
    const theme = localStorage.getItem('theme') || 'auto'
    document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
  </script>


  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../index.html">
            <img id="logo" class="svg" src="../logo.svg" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" style="margin-top: -.65em; margin-left: -.8em" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="setup">SetUp</h1>

<br>
<div class="alert alert-success">
<h5>REGISTER</h5>
<p>こちらから参加登録!
<a href="https://www.jsae.or.jp/jaaic/en/index.php">https://www.jsae.or.jp/jaaic/en/index.php</a></p>
</div>
<br>
<h2 id="minimum-hardware-requirements">Minimum Hardware Requirements</h2>
<ul>
<li>OS: Ubuntu 22.04</li>
<li>CPU: Intel Corei7 (8 cores) or higher</li>
<li>GPU: NVIDIA Geforce RTX 1060 or higher</li>
<li>Memory: 32 GB or more</li>
<li>Storage: SSD 30 GB or higher</li>
</ul>
<h3 id="for-those-using-two-pcs">For Those Using Two PCs</h3>
<h4 id="autoware-pc">Autoware PC</h4>
<ul>
<li>OS: Ubuntu 22.04</li>
<li>CPU: Intel Corei7 (4 cores) or higher</li>
<li>GPU: NVIDIA Geforce GTX 1060 or higher</li>
<li>Memory: 16 GB or higher</li>
<li>Storage: SSD 10 GB or higher</li>
<li>Details<a href="https://autowarefoundation.github.io/autoware-documentation/main/installation/">Here</a></li>
</ul>
<h4 id="awsim-pc">AWSIM PC</h4>
<ul>
<li>OS: Ubuntu 22.04</li>
<li>CPU: Intel Corei7 (4 cores and 8 threads) or higher</li>
<li>GPU: NVIDIA Geforce RTX 1060 or higher</li>
</ul>
<p>※&quot;Please place the Autoware operation PC and the AWSIM operation PC within the same network. If they are properly configured, topic communication between PCs is possible without any additional settings. If, by any chance, topic communication is not possible, please disable the firewall or review its rules.&quot;</p>
<h3 id="for-those-using-cpu-only-pcs">For Those Using CPU Only PCs</h3>
<h4 id="minimum-hardware-requirements-for-headless-mode">Minimum Hardware Requirements for Headless mode</h4>
<p>&quot;We may not be able to fully support the operational environment of PCs used in this competition. However, to encourage more people to participate in the contest and engage in active discussions, we have experimentally made it possible to participate with the following CPU-only configuration.</p>
<ul>
<li>OS: Ubuntu 22.04</li>
<li>CPU: Intel Core i7-8650U (4 cores) with Intel HD Graphics (no NVIDIA GPUs)</li>
<li>Memory: 16 GB or more</li>
<li>Storage: SSD 16 GB or higher</li>
</ul>
<ul>
<li>other CPU only cases</li>
</ul>
<ul>
<li><p>CPU : AMD Ryzen 5 5600G with Radeon Graphics</p>
</li>
<li><p>Memory : 32GB</p>
</li>
<li><p>CPU AMD® Ryzen 7 pro 4750u with radeon graphics × 16</p>
</li>
<li><p>Memory 32.0 GiB</p>
</li>
<li><p>DELL XPS 13 9300</p>
</li>
<li><p>CPU: Intel(R) Core(TM) i7-1065G7</p>
</li>
<li><p>Memory: 16GB</p>
</li>
</ul>
<h2 id="environment-setup">Environment Setup</h2>
<h3 id="awsimubuntu">AWSIM(Ubuntu)</h3>
<h4 id="preparation">preparation</h4>
<ul>
<li><p>(Skip this step if you are using a CPU only or already have NVIDIA Driver installed) Installing Nvidia drivers.</p>
<ol>
<li>add repo、update、install</li>
</ol>
<pre><code class="lang-sh">sudo add-apt-repository ppa:graphics-drivers/ppa
sudo apt update
sudo ubuntu-drivers autoinstall
</code></pre>
<ol start="2">
<li>after restart、make sure you can run below command</li>
</ol>
<pre><code>nvidia-smi
</code></pre>
<p><img src="../../images/setup/nvidia-smi.png" alt="nvidia-smi"></p>
</li>
<li><p>install Vulkun</p>
<ol>
<li>update package list</li>
</ol>
<pre><code class="lang-sh">sudo apt update
sudo apt install libvulkan1
</code></pre>
</li>
<li><p>prepare curse</p>
<ol>
<li><a href="https://drive.google.com/drive/folders/1EjgBxB_x0_xRla7_FdPaeEkiOU3vxW7e">GoogleDrive Download Link</a> place <code>AWSIM.zip</code> to　<code>aichallenge2023-racing/docker/aichallenge</code></li>
<li>permission change<br>
<img src="../../images/setup/permmision.png" alt="scene"></li>
<li>double click file to run simulator</li>
<li>Ensure that the GPU version of AWSIM displays a screen like the one shown below.
(CPU version of AWSIM does not displays anything)
<img src="../../images/setup/awsim.png" alt="awsim"></li>
</ol>
</li>
</ul>
<h3 id="docker-preparation">Docker Preparation</h3>
<p>Install below</p>
<ul>
<li><a href="https://docs.docker.com/engine/install/ubuntu/">docker</a></li>
<li><a href="https://github.com/osrf/rocker">rocker</a>
<ul>
<li>This is used for running GUI applications like Rviz, rqt, etc., inside Docker containers.</li>
</ul>
</li>
<li><a href="https://packagecloud.io/github/git-lfs/install">git lfs</a></li>
</ul>
<p>The following commands will install docker, rocker, and git lfs.</p>
<pre><code class="lang-sh">sudo apt-get update
sudo apt-get install ca-certificates curl gnupg
sudo install -m 0755 -d /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
sudo chmod a+r /etc/apt/keyrings/docker.gpg
echo \
  &quot;deb [arch=&quot;$(dpkg --print-architecture)&quot; signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
  &quot;$(. /etc/os-release &amp;&amp; echo &quot;$VERSION_CODENAME&quot;)&quot; stable&quot; | \
  sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null
sudo apt-get update
sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
sudo docker run hello-world

# rocker install
sudo apt-get install python3-rocker

# gitlfs install
curl -s https://packagecloud.io/install/repositories/github/git-lfs/script.deb.sh | sudo bash
sudo apt-get install git-lfs
git lfs install
</code></pre>
<ul>
<li>(For those who use CPU only PC skip this step)<a href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/install-guide.html">Nvidia Container Toolkit</a></li>
</ul>
<pre><code class="lang-sh">distribution=$(. /etc/os-release;echo $ID$VERSION_ID) \
      &amp;&amp; curl -fsSL https://nvidia.github.io/libnvidia-container/gpgkey | sudo gpg --dearmor -o /usr/share/keyrings/nvidia-container-toolkit-keyring.gpg \
      &amp;&amp; curl -s -L https://nvidia.github.io/libnvidia-container/$distribution/libnvidia-container.list | \
            sed 's#deb https://#deb [signed-by=/usr/share/keyrings/nvidia-container-toolkit-keyring.gpg] https://#g' | \
            sudo tee /etc/apt/sources.list.d/nvidia-container-toolkit.list

sudo apt-get update
sudo apt-get install -y nvidia-container-toolkit
sudo nvidia-ctk runtime configure --runtime=docker
sudo systemctl restart docker

sudo docker run --rm --runtime=nvidia --gpus all nvidia/cuda:11.6.2-base-ubuntu20.04 nvidia-smi


# +-----------------------------------------------------------------------------+
# | NVIDIA-SMI 450.51.06    Driver Version: 450.51.06    CUDA Version: 11.0     |
# |-------------------------------+----------------------+----------------------+
# | GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |
# | Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |
# |                               |                      |               MIG M. |
# |===============================+======================+======================|
# |   0  Tesla T4            On   | 00000000:00:1E.0 Off |                    0 |
# | N/A   34C    P8     9W /  70W |      0MiB / 15109MiB |      0%      Default |
# |                               |                      |                  N/A |
# +-------------------------------+----------------------+----------------------+
# +-----------------------------------------------------------------------------+
# | Processes:                                                                  |
# |  GPU   GI   CI        PID   Type   Process name                  GPU Memory |
# |        ID   ID                                                   Usage      |
# |=============================================================================|
# |  No running processes found                                                 |
# +-----------------------------------------------------------------------------+

</code></pre>
<ul>
<li><p>Preparing &amp; Starting the Docker Image - Setting up Autoware</p>
<ol>
<li>Obtaining the Docker Image</li>
</ol>
<pre><code>docker pull ghcr.io/automotiveaichallenge/aichallenge2023-racing/autoware-universe-no-cuda
</code></pre>
<p>Add your account to the user group</p>
<pre><code>sudo usermod -aG docker $USER
</code></pre>
<p>Confirm that docker has been added to groups with the following command</p>
<pre><code>groups $USER
# $ USERNAME : USERNAME adm cdrom sudo ... docker
</code></pre>
<p>Once confirmed, re-login</p>
<p>Check that the following display is visible in docker images</p>
<pre><code>REPOSITORY                                                                       TAG                                 IMAGE ID       CREATED          SIZE
ghcr.io/automotiveaichallenge/aichallenge2023-racing/autoware-universe-no-cuda   latest                              9601fc85f1bd   3 weeks ago      7.31GB    
</code></pre>
<ol start="2">
<li>Downloading Competition Data</li>
</ol>
<pre><code>sudo apt install -y git-lfs
git lfs clone https://github.com/AutomotiveAIChallenge/aichallenge2023-racing
</code></pre>
<ol start="3">
<li>Building the Competition Docker Image</li>
</ol>
<pre><code>cd aichallenge2023-racing/docker/train
bash build_docker.sh
</code></pre>
<ol start="4">
<li>Starting the Competition Docker Container</li>
</ol>
<p>For GPU environments</p>
<pre><code>bash run_container.sh
</code></pre>
<p>For CPU only environments</p>
<pre><code>bash run_container_cpu.sh
</code></pre>
</li>
</ul>
<h4 id="starting-awsim-in-a-docker-container">Starting AWSIM in a Docker Container</h4>
<p>If you want to start AWSIM from a Docker container, follow the Docker image preparation steps (described previously) to install the Docker image, and then proceed with the following steps:</p>
<ol>
<li>Extract the competition's AWSIM executable file into <code>aichallenge2023-racing/docker/aichallenge</code> (for the purposes of this guide, we will assume it's located at <code>aichallenge2023-racing/docker/aichallenge/AWSIM/AWSIM.x86_64</code>).</li>
<li>Start rocker
Open a new terminal and confirm that an image like the one below exists with <code>docker image ls</code>.</li>
</ol>
<pre><code>REPOSITORY                                                                      TAG                                 IMAGE ID       CREATED          SIZE
aichallenge-train                                                               latest                              67a4d45d119d   16 minutes ago   7.37GB
</code></pre>
<p>Once confirmed, start rocker with the following commands.</p>
<p>For GPU environments</p>
<pre><code> cd ./aichallenge2023-racing/docker/train
 bash run_container.sh
</code></pre>
<p>For CPU-only environments</p>
<pre><code> cd ./aichallenge2023-racing/docker/train
 bash run_container_cpu.sh
</code></pre>
<p>In the new terminal, confirm that docker exists as shown below with <code>docker images</code>.</p>
<pre><code>REPOSITORY                                                                      TAG                                 IMAGE ID       CREATED          SIZE
aichallenge-train                                                               latest                              67a4d45d119d   16 minutes ago   7.37GB   
</code></pre>
<ol start="3">
<li>Execute the following inside the container</li>
</ol>
<pre><code> cd /aichallenge
 bash run_awsim.sh 
</code></pre>
<div class="NOTE">
<h5>Note</h5>
<p>The messages published and subscribed by AWSIM are partially defined in <code>/aichallenge/aichallenge_ws/src/sim-msgs</code>. To handle these messages, please execute the following commands.</p>
<pre><code>cd /aichallenge
bash build_autoware.sh
source /aichallenge/aichallenge_ws/install/setup.bash 
</code></pre>
</div>
<h3 id="placement-of-map-data-osm-work-in-progress-wip">Placement of Map Data OSM Work in Progress (WIP)</h3>
<p>For this competition, we have allowed modifications to the lanelet2_map file. Please place it in <code>/aichallenge2023-racing/docker/aichallenge/aichallenge_ws/src/aichallenge_submit/aichallenge_submit_launch/map/*</code>, ensuring the file structure is as follows:</p>
<pre><code>aichallenge2023-racing
└ docker
 └ aichallenge
  └ AWSIM
  └ aichallenge_ws/src/aichallenge_submit/aichallenge_submit_launch
     └map
      └lanelet2_map.osm
</code></pre>
<p>※ There are no constraints such as having to refer to the lanelet2_map for route planning (referring to a csv file to generate routes is also permissible).
※ PCD files are included, but there is no need to submit them this time. Use them only if necessary for editing the map.</p>
<h3 id="autoware">Autoware</h3>
<ul>
<li>Checking Autoware Operation<br>
Here we describe how to check Autoware's operation using AWSIM.
<ol>
<li>Start AWSIM</li>
<li>Start Autoware</li>
</ol>
<pre><code># Inside the Rocker container
cd /aichallenge
bash build_autoware.sh
bash run_autoware.sh
</code></pre>
<ol start="3">
<li>Ensure that a screen like Rviz2 is displayed as shown below. And Confirm that the route is displayed as in the image and that <code>Routing</code> changes from <code>UNSET</code> to <code>SET</code>
<img src="../../images/setup/autoware.png" alt="autoware1"></li>
</ol>
</li>
</ul>
<h3 id="starting-from-the-second-time-onwards">Starting from the Second Time Onwards</h3>
<ol>
<li>Starting AWSIM
<ol>
<li>Start the container</li>
</ol>
<pre><code> cd ./aichallenge2023-racing/docker/train
 bash run_container.sh or bash run_container_cpu.sh
</code></pre>
<ol start="2">
<li>Start AWSIM inside the container</li>
</ol>
<pre><code> cd /aichallenge
 bash run_awsim.sh 
</code></pre>
</li>
<li>Starting Autoware
<ol>
<li>Start the container</li>
</ol>
<pre><code> cd ./aichallenge2023-racing/docker/train
 bash run_container.sh or bash run_container_cpu.sh
</code></pre>
<ol start="2">
<li>Build Autoware inside the container if necessary</li>
</ol>
<pre><code> cd /aichallenge
 bash build_autoware.sh 
</code></pre>
<ol start="3">
<li>Start Autoware inside the container</li>
</ol>
<pre><code> cd /aichallenge
 bash run_autoware.sh
</code></pre>
</li>
</ol>
<h3 id="how-to-record-the-screen">How to Record the Screen</h3>
<p>The default rocker setup doesn't set the display driver to your own PC, so you need to add the following options:</p>
<pre><code>#!/bin/bash
rocker --device /dev/dri --x11 --user ... # For CPU version
rocker --device /dev/dri --nvidia --x11 --user ... # For GPU version
</code></pre>
<h3 id="incorporating-changes">Incorporating Changes</h3>
<h4 id="updating-docker">Updating Docker</h4>
<pre><code class="lang-sh">docker pull ghcr.io/automotiveaichallenge/aichallenge2023-racing/autoware-universe-no-cuda
</code></pre>
<h4 id="updating-the-repository">Updating the Repository</h4>
<pre><code class="lang-sh">cd aichallenge2023-racing # path to aichallenge2023-racing
git pull origin/main
</code></pre>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/AutomotiveAIChallenge/aichallenge2023-racing/blob/main/documentation/docfx_project_en/setup/index.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>


    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>
